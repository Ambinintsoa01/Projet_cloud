import{u as J,y as w,ai as g,o as W,c as X,w as o,a as e,I as Y,b as Z,d as I,e as a,K as ee,L as te,M as ae,g as s,f as oe,aj as se,s as R,i as d,m as f,a6 as le,a7 as ne,a8 as b,P as re,ak as C,al as M,D as c,l as v,C as p,am as D,q as ue,z as y,an as ie,ah as T,t as ce}from"./index-vCZlUi6s.js";import{u as de}from"./reports.store-CFG89qXN.js";import{u as me}from"./useOfflineStorage-B5XdQuUJ.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSignalements-Bl-XL2BA.js";const pe={class:"profile-header"},fe={class:"avatar-section"},ve=["src","alt"],_e={key:1,class:"avatar-placeholder"},he={class:"user-name"},ke={class:"user-email"},ye={class:"stats-section"},Se={class:"stat-item"},we={class:"stat-value"},Ie={class:"stat-item"},be={class:"stat-value"},Ce={class:"stat-item"},Me={class:"stat-value"},xe={class:"logout-section"},Pe={__name:"ProfileScreen",setup(Le){const V=Z(),_=J(),h=de();me();const n=w(g.getUserPreferences()),x=w(g.getStorageStats());w(g.getAppSettings().lastSync);const m=y(()=>{const l=_.user||{};return console.log("üë§ User data:",l),l}),S=y(()=>{var L,A;const l=(L=_.user)==null?void 0:L.id,t=(A=_.user)==null?void 0:A.email;console.log("üìä Calcul stats pour:",{userId:l,userEmail:t}),console.log("üìä Total signalements:",h.reports.length);const r=h.reports.filter(i=>{var E,U;const k=i.userId||i.user_id||i.createdBy||i.created_by,$=i.userEmail||i.user_email||i.email;return k===l||$===t||((E=i.user)==null?void 0:E.id)===l||((U=i.user)==null?void 0:U.email)===t});return console.log("üìä Mes signalements:",r.length),{total:r.length,resolved:r.filter(i=>{const k=(i.status||"").toLowerCase();return k==="completed"||k==="termin√©"||k==="termine"}).length,points:r.length*10}}),P=y(()=>"1.0.0"),F=()=>{u("Fonctionnalit√© √† venir","warning")},N=()=>{u("Fonctionnalit√© √† venir","warning")},z=y(()=>n.value.darkMode||!1),B=async l=>{try{n.value.darkMode=l,document.documentElement.classList.toggle("ion-palette-dark",l),g.setUserPreferences(n.value),await u(l?"Mode sombre activ√©":"Mode clair activ√©","success"),console.log("üåô Mode sombre:",l)}catch(t){console.error("Erreur mode sombre:",t),await u("Erreur lors du changement de th√®me","danger")}},j=async(l,t)=>{try{n.value[l]=t,g.setUserPreferences(n.value),await u("Pr√©f√©rence mise √† jour","success")}catch(r){console.error("Erreur lors de la mise √† jour:",r),await u("Erreur lors de la mise √† jour","danger")}},q=async()=>{await(await ie.create({header:"Choisir la langue",buttons:[{text:"Fran√ßais",icon:n.value.language==="fr"?"checkmark":void 0,handler:async()=>{n.value.language="fr",g.setUserPreferences(n.value),await u("Langue chang√©e : Fran√ßais","success"),console.log("üåç Langue:","fr")}},{text:"Malagasy",icon:n.value.language==="mg"?"checkmark":void 0,handler:async()=>{n.value.language="mg",g.setUserPreferences(n.value),await u("Langue chang√©e : Malagasy","success"),console.log("üåç Langue:","mg")}},{text:"Annuler",role:"cancel"}]})).present()},H=()=>{u("Centre d'aide √† venir","info")},G=()=>{u("Support client √† venir","info")},O=async()=>{await(await T.create({header:"√Ä propos",subHeader:"Signalement Travaux Routiers",message:`
      <div style="text-align: center;">
        <p><strong>Version:</strong> ${P.value}</p>
        <p><strong>D√©veloppeur:</strong> MrRojo Team</p>
        <p><strong>Ann√©e:</strong> 2026</p>
        <br>
        <p style="font-size: 14px; color: var(--ion-color-medium);">
          Application mobile de signalement des probl√®mes routiers √† Antananarivo.
        </p>
      </div>
    `,buttons:["Fermer"]})).present()},Q=async()=>{await(await T.create({header:"Confirmer la d√©connexion",message:"√ätes-vous s√ªr de vouloir vous d√©connecter ?",buttons:[{text:"Annuler",role:"cancel"},{text:"Se d√©connecter",role:"destructive",handler:async()=>{await K()}}]})).present()},K=async()=>{try{await _.logout(),await u("D√©connexion r√©ussie","success"),V.push("/login")}catch(l){console.error("Erreur lors de la d√©connexion:",l),await u("Erreur lors de la d√©connexion","danger")}},u=async(l,t="primary")=>{await(await ce.create({message:l,duration:2e3,color:t,position:"top"})).present()};return W(async()=>{console.log("üì± ProfileScreen mounted"),console.log("üë§ User:",_.user),n.value.darkMode===!0?(document.documentElement.classList.add("ion-palette-dark"),console.log("üåô Mode sombre appliqu√©")):(document.documentElement.classList.remove("ion-palette-dark"),console.log("‚òÄÔ∏è Mode clair appliqu√©")),h.reports.length===0&&(console.log("üîÑ Chargement des signalements..."),await h.fetchReports(),console.log("‚úÖ Signalements charg√©s:",h.reports.length)),x.value=g.getStorageStats(),console.log("üíæ Stats stockage:",x.value),console.log("üåç Langue actuelle:",n.value.language||"fr"),console.log("üåô Mode sombre:",n.value.darkMode)}),(l,t)=>(I(),X(e(Y),null,{default:o(()=>[a(e(ee),null,{default:o(()=>[a(e(te),null,{default:o(()=>[a(e(ae),null,{default:o(()=>[...t[3]||(t[3]=[s("span",{class:"app-logo"},"ROAD ALERT",-1),s("span",{class:"title-sep"},"‚Ä¢",-1),s("span",{class:"app-title"},"Profil",-1)])]),_:1})]),_:1})]),_:1}),a(e(oe),{fullscreen:!0,class:"profile-content"},{default:o(()=>[s("div",pe,[s("div",fe,[a(e(se),{class:"profile-avatar"},{default:o(()=>[m.value.avatar?(I(),R("img",{key:0,src:m.value.avatar,alt:"Avatar de "+(m.value.fullName||m.value.name||"Utilisateur")},null,8,ve)):(I(),R("div",_e,[a(e(d),{name:"person",size:"large"})]))]),_:1}),s("h2",he,f(m.value.fullName||m.value.name||m.value.email||"Utilisateur"),1),s("p",ke,f(m.value.email||"Email non d√©fini"),1)])]),s("div",ye,[a(e(le),{class:"user-stats"},{default:o(()=>[a(e(ne),null,{default:o(()=>[a(e(b),{size:"4"},{default:o(()=>[s("div",Se,[s("div",we,f(S.value.total),1),t[4]||(t[4]=s("div",{class:"stat-label"},"Signalements",-1))])]),_:1}),a(e(b),{size:"4"},{default:o(()=>[s("div",Ie,[s("div",be,f(S.value.resolved),1),t[5]||(t[5]=s("div",{class:"stat-label"},"R√©solus",-1))])]),_:1}),a(e(b),{size:"4"},{default:o(()=>[s("div",Ce,[s("div",Me,f(S.value.points),1),t[6]||(t[6]=s("div",{class:"stat-label"},"Points",-1))])]),_:1})]),_:1})]),_:1})]),a(e(re),{class:"profile-menu"},{default:o(()=>[a(e(C),null,{default:o(()=>[a(e(M),null,{default:o(()=>[a(e(c),null,{default:o(()=>[...t[7]||(t[7]=[v("Informations personnelles",-1)])]),_:1})]),_:1}),a(e(p),{button:"",onClick:F,detail:""},{default:o(()=>[a(e(d),{name:"person",slot:"start",color:"primary"}),a(e(c),null,{default:o(()=>[...t[8]||(t[8]=[s("h3",null,"Modifier le profil",-1),s("p",null,"Nom, email, avatar",-1)])]),_:1})]),_:1}),a(e(p),{button:"",onClick:N,detail:""},{default:o(()=>[a(e(d),{name:"lock-closed",slot:"start",color:"secondary"}),a(e(c),null,{default:o(()=>[...t[9]||(t[9]=[s("h3",null,"Changer le mot de passe",-1),s("p",null,"S√©curiser votre compte",-1)])]),_:1})]),_:1})]),_:1}),a(e(C),null,{default:o(()=>[a(e(M),null,{default:o(()=>[a(e(c),null,{default:o(()=>[...t[10]||(t[10]=[v("Pr√©f√©rences",-1)])]),_:1})]),_:1}),a(e(p),null,{default:o(()=>[a(e(d),{name:"moon",slot:"start",color:"tertiary"}),a(e(c),null,{default:o(()=>[...t[11]||(t[11]=[v("Mode sombre",-1)])]),_:1}),a(e(D),{checked:z.value,onIonChange:t[0]||(t[0]=r=>B(r.detail.checked)),slot:"end"},null,8,["checked"])]),_:1}),a(e(p),null,{default:o(()=>[a(e(d),{name:"notifications",slot:"start",color:"warning"}),a(e(c),null,{default:o(()=>[...t[12]||(t[12]=[v("Notifications push",-1)])]),_:1}),a(e(D),{modelValue:n.value.notifications,"onUpdate:modelValue":t[1]||(t[1]=r=>n.value.notifications=r),onIonChange:t[2]||(t[2]=r=>j("notifications",r.detail.checked)),slot:"end"},null,8,["modelValue"])]),_:1}),a(e(p),{button:"",onClick:q,detail:""},{default:o(()=>[a(e(d),{name:"language",slot:"start",color:"success"}),a(e(c),null,{default:o(()=>[t[13]||(t[13]=s("h3",null,"Langue",-1)),s("p",null,f(n.value.language==="fr"?"Fran√ßais":"Malagasy"),1)]),_:1})]),_:1})]),_:1}),a(e(C),null,{default:o(()=>[a(e(M),null,{default:o(()=>[a(e(c),null,{default:o(()=>[...t[14]||(t[14]=[v("Support & Aide",-1)])]),_:1})]),_:1}),a(e(p),{button:"",onClick:H,detail:""},{default:o(()=>[a(e(d),{name:"help-circle",slot:"start",color:"info"}),a(e(c),null,{default:o(()=>[...t[15]||(t[15]=[s("h3",null,"Aide & FAQ",-1),s("p",null,"Questions fr√©quentes",-1)])]),_:1})]),_:1}),a(e(p),{button:"",onClick:G,detail:""},{default:o(()=>[a(e(d),{name:"mail",slot:"start",color:"primary"}),a(e(c),null,{default:o(()=>[...t[16]||(t[16]=[s("h3",null,"Contacter le support",-1),s("p",null,"Signaler un probl√®me",-1)])]),_:1})]),_:1}),a(e(p),{button:"",onClick:O,detail:""},{default:o(()=>[a(e(d),{name:"information-circle",slot:"start",color:"medium"}),a(e(c),null,{default:o(()=>[t[17]||(t[17]=s("h3",null,"√Ä propos",-1)),s("p",null,"Version "+f(P.value),1)]),_:1})]),_:1})]),_:1})]),_:1}),s("div",xe,[a(e(ue),{expand:"block",fill:"outline",color:"danger",onClick:Q,class:"logout-button"},{default:o(()=>[a(e(d),{name:"log-out",slot:"start"}),t[18]||(t[18]=v(" Se d√©connecter ",-1))]),_:1})])]),_:1})]),_:1}))}},Te=ge(Pe,[["__scopeId","data-v-16c78807"]]);export{Te as default};
