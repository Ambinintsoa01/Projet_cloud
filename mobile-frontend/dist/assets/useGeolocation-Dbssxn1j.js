const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-BLF3XU9Q.js","assets/index-vCZlUi6s.js","assets/index-B8OeBx2z.css"])))=>i.map(i=>d[i]);
import{a3 as z,y as w,z as k,a4 as K,o as V,H as J}from"./index-vCZlUi6s.js";const Q=z("map",()=>{const n=w([-18.8792,47.5079]),e=w(13),t=w(null),a=w(null),r=w(!1),o=w(null),i=w([]),c=w([]),u=w({minZoom:12,maxZoom:18,zoomControl:!1,attributionControl:!0,scrollWheelZoom:!0,dragging:!0,touchZoom:!0,doubleClickZoom:!0,boxZoom:!1,keyboard:!1}),g=w({url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:"Â© OpenStreetMap contributors",maxZoom:19}}),E=k(()=>n.value),d=k(()=>e.value),f=k(()=>t.value),x=k(()=>!!t.value),L=k(()=>a.value);function h(s){n.value=Array.isArray(s)?s:[s.lat,s.lng]}function l(s){e.value=Math.max(u.value.minZoom,Math.min(u.value.maxZoom,s))}function m(s){t.value={lat:s.coords.latitude,lng:s.coords.longitude,accuracy:s.coords.accuracy,timestamp:s.timestamp},r.value&&h([s.coords.latitude,s.coords.longitude])}function R(s){a.value=s?{lat:s.lat,lng:s.lng,address:s.address||null}:null}function $(s){r.value=s}function M(){t.value&&(h([t.value.lat,t.value.lng]),l(16))}function O(){h([-18.8792,47.5079]),l(13)}function S(s){o.value&&s&&o.value.fitBounds(s)}function j(s){i.value.push({id:s.id||`marker_${Date.now()}`,position:[s.lat,s.lng],type:s.type||"default",data:s.data||{},popup:s.popup||null})}function v(s){const A=i.value.findIndex(D=>D.id===s);A>-1&&i.value.splice(A,1)}function p(){i.value=[]}function b(s){o.value=s}function P(){const s={coords:{latitude:-18.8792+(Math.random()-.5)*.01,longitude:47.5079+(Math.random()-.5)*.01,accuracy:10+Math.random()*20},timestamp:Date.now()};return m(s),s}async function C(s,A){await new Promise(Z=>setTimeout(Z,800));const D=["Rue Andriantsihorisoa, Antananarivo","Avenue de l'IndÃ©pendance, Antananarivo","Boulevard de l'Europe, Antananarivo","Rue Ratsimilaho, Antananarivo","Place du 13 Mai, Antananarivo","Rue Pasteur, Antananarivo","Rue Indira Gandhi, Antananarivo","Carrefour Analakely, Antananarivo"];return{address:D[Math.floor(Math.random()*D.length)],details:`CoordonnÃ©es: ${s.toFixed(6)}, ${A.toFixed(6)}`}}function y(){n.value=[-18.8792,47.5079],e.value=13,t.value=null,a.value=null,r.value=!1,i.value=[],c.value=[]}return{center:n,zoom:e,userLocation:t,selectedLocation:a,isFollowingUser:r,mapInstance:o,markers:i,clusters:c,mapConfig:u,tileLayer:g,getCenter:E,getZoom:d,getUserLocation:f,hasUserLocation:x,getSelectedLocation:L,setCenter:h,setZoom:l,updateUserLocation:m,setSelectedLocation:R,setFollowingUser:$,centerOnUser:M,centerOnAntananarivo:O,fitBounds:S,addMarker:j,removeMarker:v,clearMarkers:p,setMapInstance:b,simulateUserLocation:P,reverseGeocode:C,reset:y}});/*! Capacitor: https://capacitorjs.com/ - MIT License */var I;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(I||(I={}));class _ extends Error{constructor(e,t,a){super(e),this.message=e,this.code=t,this.data=a}}const X=n=>{var e,t;return n!=null&&n.androidBridge?"android":!((t=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},Y=n=>{const e=n.CapacitorCustomPlatform||null,t=n.Capacitor||{},a=t.Plugins=t.Plugins||{},r=()=>e!==null?e.name:X(n),o=()=>r()!=="web",i=d=>{const f=g.get(d);return!!(f!=null&&f.platforms.has(r())||c(d))},c=d=>{var f;return(f=t.PluginHeaders)===null||f===void 0?void 0:f.find(x=>x.name===d)},u=d=>n.console.error(d),g=new Map,E=(d,f={})=>{const x=g.get(d);if(x)return console.warn(`Capacitor plugin "${d}" already registered. Cannot register plugins twice.`),x.proxy;const L=r(),h=c(d);let l;const m=async()=>(!l&&L in f?l=typeof f[L]=="function"?l=await f[L]():l=f[L]:e!==null&&!l&&"web"in f&&(l=typeof f.web=="function"?l=await f.web():l=f.web),l),R=(v,p)=>{var b,P;if(h){const C=h==null?void 0:h.methods.find(y=>p===y.name);if(C)return C.rtype==="promise"?y=>t.nativePromise(d,p.toString(),y):(y,s)=>t.nativeCallback(d,p.toString(),y,s);if(v)return(b=v[p])===null||b===void 0?void 0:b.bind(v)}else{if(v)return(P=v[p])===null||P===void 0?void 0:P.bind(v);throw new _(`"${d}" plugin is not implemented on ${L}`,I.Unimplemented)}},$=v=>{let p;const b=(...P)=>{const C=m().then(y=>{const s=R(y,v);if(s){const A=s(...P);return p=A==null?void 0:A.remove,A}else throw new _(`"${d}.${v}()" is not implemented on ${L}`,I.Unimplemented)});return v==="addListener"&&(C.remove=async()=>p()),C};return b.toString=()=>`${v.toString()}() { [capacitor code] }`,Object.defineProperty(b,"name",{value:v,writable:!1,configurable:!1}),b},M=$("addListener"),O=$("removeListener"),S=(v,p)=>{const b=M({eventName:v},p),P=async()=>{const y=await b;O({eventName:v,callbackId:y},p)},C=new Promise(y=>b.then(()=>y({remove:P})));return C.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await P()},C},j=new Proxy({},{get(v,p){switch(p){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return h?S:M;case"removeListener":return O;default:return $(p)}}});return a[d]=j,g.set(d,{name:d,proxy:j,platforms:new Set([...Object.keys(f),...h?[L]:[]])}),j};return t.convertFileSrc||(t.convertFileSrc=d=>d),t.getPlatform=r,t.handleError=u,t.isNativePlatform=o,t.isPluginAvailable=i,t.registerPlugin=E,t.Exception=_,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},N=n=>n.Capacitor=Y(n),T=N(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),W=T.registerPlugin;class B{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let a=!1;this.listeners[e]||(this.listeners[e]=[],a=!0),this.listeners[e].push(t);const o=this.windowListeners[e];o&&!o.registered&&this.addWindowListener(o),a&&this.sendRetainedArgumentsForEvent(e);const i=async()=>this.removeListener(e,t);return Promise.resolve({remove:i})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,a){const r=this.listeners[e];if(!r){if(a){let o=this.retainedEventArguments[e];o||(o=[]),o.push(t),this.retainedEventArguments[e]=o}return}r.forEach(o=>o(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:a=>{this.notifyListeners(t,a)}}}unimplemented(e="not implemented"){return new T.Exception(e,I.Unimplemented)}unavailable(e="not available"){return new T.Exception(e,I.Unavailable)}async removeListener(e,t){const a=this.listeners[e];if(!a)return;const r=a.indexOf(t);this.listeners[e].splice(r,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(a=>{this.notifyListeners(e,a)}))}}const H=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),F=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class ee extends B{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(a=>{if(a.length<=0)return;let[r,o]=a.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");r=F(r).trim(),o=F(o).trim(),t[r]=o}),t}async setCookie(e){try{const t=H(e.key),a=H(e.value),r=`; expires=${(e.expires||"").replace("expires=","")}`,o=(e.path||"/").replace("path=",""),i=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${a||""}${r}; path=${o}; ${i};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}W("CapacitorCookies",{web:()=>new ee});const te=async n=>new Promise((e,t)=>{const a=new FileReader;a.onload=()=>{const r=a.result;e(r.indexOf(",")>=0?r.split(",")[1]:r)},a.onerror=r=>t(r),a.readAsDataURL(n)}),ne=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(r=>r.toLocaleLowerCase()).reduce((r,o,i)=>(r[o]=n[e[i]],r),{})},re=(n,e=!0)=>n?Object.entries(n).reduce((a,r)=>{const[o,i]=r;let c,u;return Array.isArray(i)?(u="",i.forEach(g=>{c=e?encodeURIComponent(g):g,u+=`${o}=${c}&`}),u.slice(0,-1)):(c=e?encodeURIComponent(i):i,u=`${o}=${c}`),`${a}&${u}`},"").substr(1):null,oe=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),r=ne(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(r.includes("application/x-www-form-urlencoded")){const o=new URLSearchParams;for(const[i,c]of Object.entries(n.data||{}))o.set(i,c);t.body=o.toString()}else if(r.includes("multipart/form-data")||n.data instanceof FormData){const o=new FormData;if(n.data instanceof FormData)n.data.forEach((c,u)=>{o.append(u,c)});else for(const c of Object.keys(n.data))o.append(c,n.data[c]);t.body=o;const i=new Headers(t.headers);i.delete("content-type"),t.headers=i}else(r.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class ae extends B{async request(e){const t=oe(e,e.webFetchExtra),a=re(e.params,e.shouldEncodeUrlParams),r=a?`${e.url}?${a}`:e.url,o=await fetch(r,t),i=o.headers.get("content-type")||"";let{responseType:c="text"}=o.ok?e:{};i.includes("application/json")&&(c="json");let u,g;switch(c){case"arraybuffer":case"blob":g=await o.blob(),u=await te(g);break;case"json":u=await o.json();break;case"document":case"text":default:u=await o.text()}const E={};return o.headers.forEach((d,f)=>{E[f]=d}),{data:u,headers:E,status:o.status,url:o.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}W("CapacitorHttp",{web:()=>new ae});var G;(function(n){n.Dark="DARK",n.Light="LIGHT",n.Default="DEFAULT"})(G||(G={}));var q;(function(n){n.StatusBar="StatusBar",n.NavigationBar="NavigationBar"})(q||(q={}));class se extends B{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}W("SystemBars",{web:()=>new se});function ie(n){n.CapacitorUtils.Synapse=new Proxy({},{get(e,t){return new Proxy({},{get(a,r){return(o,i,c)=>{const u=n.Capacitor.Plugins[t];if(u===void 0){c(new Error(`Capacitor plugin ${t} not found`));return}if(typeof u[r]!="function"){c(new Error(`Method ${r} not found in Capacitor plugin ${t}`));return}(async()=>{try{const g=await u[r](o);i(g)}catch(g){c(g)}})()}}})}})}function ce(n){n.CapacitorUtils.Synapse=new Proxy({},{get(e,t){return n.cordova.plugins[t]}})}function le(n=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!n?ie(window):window.cordova!==void 0&&ce(window))}const U=W("Geolocation",{web:()=>K(()=>import("./web-BLF3XU9Q.js"),__vite__mapDeps([0,1,2])).then(n=>new n.GeolocationWeb)});le();function fe(){const n=Q(),e=w(!1),t=w(!1),a=w(null),r=w(null),o=k(()=>n.userLocation),i=k(()=>!0),c=k(()=>!!r.value),u=()=>{e.value="geolocation"in navigator||U},g=async()=>{try{return U?(await U.requestPermissions()).location==="granted":!0}catch(h){return a.value="Erreur lors de la demande de permissions",console.error("Erreur permissions gÃ©olocalisation:",h),!1}},E=async(h={})=>{t.value=!0,a.value=null;try{if(!e.value)throw new Error("La gÃ©olocalisation n'est pas supportÃ©e");if(!U){console.log("ðŸ”„ Simulation de gÃ©olocalisation (mode dÃ©veloppement)");const m=n.simulateUserLocation();return n.updateUserLocation(m),m}const l=await U.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4,...h});return n.updateUserLocation(l),l}catch(l){a.value=l.message||"Erreur lors de la gÃ©olocalisation",console.warn("âš ï¸ GÃ©olocalisation rÃ©elle Ã©chouÃ©e, utilisation de la simulation");const m=n.simulateUserLocation();return n.updateUserLocation(m),m}finally{t.value=!1}},d=async(h={})=>{if(!e.value)return a.value="La gÃ©olocalisation n'est pas supportÃ©e",null;try{return U?r.value=await U.watchPosition({enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4,...h},(l,m)=>{m?(a.value=m.message,console.error("Erreur de suivi gÃ©olocalisation:",m)):n.updateUserLocation(l)}):r.value=setInterval(()=>{const l=n.simulateUserLocation();n.updateUserLocation(l)},1e4),r.value}catch(l){return a.value=l.message||"Erreur lors du dÃ©marrage du suivi",console.error("Erreur watchPosition:",l),null}},f=()=>{r.value&&(U&&typeof r.value=="string"?U.clearWatch({id:r.value}):typeof r.value=="number"&&clearInterval(r.value),r.value=null)},x=()=>{o.value?n.centerOnUser():E().then(()=>{n.centerOnUser()})},L=(h,l,m,R)=>{const M=(m-h)*Math.PI/180,O=(R-l)*Math.PI/180,S=Math.sin(M/2)*Math.sin(M/2)+Math.cos(h*Math.PI/180)*Math.cos(m*Math.PI/180)*Math.sin(O/2)*Math.sin(O/2);return 6371*(2*Math.atan2(Math.sqrt(S),Math.sqrt(1-S)))};return V(()=>{u()}),J(()=>{f()}),{isSupported:e,isLoading:t,error:a,watchId:r,currentPosition:o,hasPermission:i,isWatching:c,checkSupport:u,requestPermissions:g,getCurrentPosition:E,watchPosition:d,stopWatching:f,centerOnUser:x,getDistance:L}}export{_ as C,B as W,fe as a,W as r,Q as u};
