import{G as E,o as re,ao as $,H as de,c as A,w as s,a as l,I as ce,b as fe,y as h,d,e as a,K as me,L as j,V as ve,q as C,i as m,M as ge,g as o,a5 as pe,f as ye,s as v,ap as he,aq as _e,C as D,D as f,l as u,v as P,m as c,p as B,W as H,X as _,a1 as we,a2 as y,am as ke,r as Ie,P as be,F as G,B as Y,aa as Ce,$ as Re,Y as Se,Z as Te,z as K}from"./index-vCZlUi6s.js";import{u as Le}from"./reports.store-CFG89qXN.js";import{a as xe}from"./constants-CKzTGXC9.js";import{L as w}from"./leaflet-src-C8Aqtbpj.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSignalements-Bl-XL2BA.js";const Fe={key:0,class:"advanced-filters"},Ae={class:"accordion-content",slot:"content"},De={class:"filter-section"},Be={class:"filter-section"},Me={class:"filter-section"},Oe={class:"filter-section"},Ue={class:"filter-actions"},ze={class:"search-results"},qe={key:0,class:"loading-state"},Ne={key:1,class:"empty-state"},Ee={key:2,class:"results-list"},$e={class:"results-header"},je={key:0,class:"list-view"},Pe=["src","alt"],He={key:1,class:"no-image"},Ge={class:"result-title"},Ye={class:"result-type"},Ke={class:"type-icon"},Qe={class:"type-label"},We={class:"result-description"},Xe={class:"result-address"},Ze={class:"result-meta"},Je={class:"result-date"},et={key:1,class:"map-view"},tt={key:3,class:"suggestions"},lt={class:"suggestion-tags"},at={__name:"SearchScreen",setup(st){const Q=fe(),R=Le(),x=h(null),V=h(null);let r=null;const g=h(""),F=h(!1),S=h(null),T=h(!1),k=h("list"),i=h({status:"all",category:"all",dateRange:"all",myReportsOnly:!1}),W=["nid-de-poule","√©clairage","travaux","d√©chets","inondation","feu tricolore","signalisation"],M=K(()=>{let t=0;return i.value.status!=="all"&&t++,i.value.category!=="all"&&t++,i.value.dateRange!=="all"&&t++,i.value.myReportsOnly&&t++,t}),p=K(()=>{let t=[...R.reports];if(g.value.trim()){const e=g.value.toLowerCase();t=t.filter(n=>n.title.toLowerCase().includes(e)||n.description.toLowerCase().includes(e)||n.address.toLowerCase().includes(e)||N(n.status).toLowerCase().includes(e)||se(n.category).toLowerCase().includes(e))}if(i.value.status!=="all"&&(t=t.filter(e=>e.status===i.value.status)),i.value.category!=="all"&&(t=t.filter(e=>e.category===i.value.category)),i.value.dateRange!=="all"){const e=new Date;let n;switch(i.value.dateRange){case"week":n=new Date(e.getTime()-7*24*60*60*1e3);break;case"month":n=new Date(e.getFullYear(),e.getMonth(),1);break;case"year":n=new Date(e.getFullYear(),0,1);break}n&&(t=t.filter(b=>new Date(b.createdAt)>=n))}return i.value.myReportsOnly&&(t=t.filter(e=>e.createdBy==="1")),t}),O=()=>{clearTimeout(S.value),F.value=!0,S.value=setTimeout(()=>{F.value=!1,I()},300)},U=()=>{g.value="",I()},I=()=>{k.value==="map"&&z()},X=()=>{T.value=!T.value},L=()=>{I()},Z=()=>{I(),T.value=!1},J=()=>{i.value={status:"all",category:"all",dateRange:"all",myReportsOnly:!1},I()},ee=()=>{k.value=k.value==="list"?"map":"list"},te=()=>{!V.value||r||(delete w.Icon.Default.prototype._getIconUrl,w.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"}),r=w.map(V.value,{center:[-18.8792,47.5079],zoom:12,zoomControl:!0,attributionControl:!0}),w.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap contributors"}).addTo(r),z())},z=()=>{if(r&&(r.eachLayer(t=>{t instanceof w.Marker&&r.removeLayer(t)}),p.value.forEach(t=>{const e=w.marker([t.latitude,t.longitude]),n=`
      <div style="min-width: 200px;">
        <h4>${t.title}</h4>
        <p>${t.address}</p>
        <button onclick="window.viewReportFromSearch('${t.id}')" style="background: var(--ion-color-primary); color: var(--ion-text-color); border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
          Voir d√©tails
        </button>
      </div>
    `;e.bindPopup(n),e.addTo(r)}),p.value.length>0)){const t=new w.featureGroup(p.value.map(e=>w.marker([e.latitude,e.longitude])));r.fitBounds(t.getBounds(),{padding:[20,20]})}};window.viewReportFromSearch=t=>{const e=R.reports.find(n=>n.id===t);e&&q(e)};const q=t=>{R.setCurrentReport(t),Q.push("/map")},le=t=>{g.value=t,O()},ae=t=>({new:"danger",in_progress:"warning",completed:"success"})[t]||"primary",N=t=>xe[t]||t,se=t=>({pothole:"Nid-de-poule",roadwork:"Travaux en cours",lighting:"√âclairage d√©fectueux",waste:"D√©chets sur voie",traffic_light:"Feu tricolore HS",signage:"Signalisation manquante",flooding:"Inondation",other:"Autre"})[t]||t,ne=t=>{var b;const e=(t==null?void 0:t.category)||(t==null?void 0:t.typeLabel)||((b=t==null?void 0:t.type)==null?void 0:b.libelle),n={pothole:"Nid-de-poule",roadwork:"Travaux en cours",lighting:"√âclairage d√©fectueux",waste:"D√©chets sur voie",traffic_light:"Feu tricolore HS",signage:"Signalisation manquante",flooding:"Inondation",other:"Autre"};return n[e]?n[e]:typeof e=="string"&&e.trim()?e:"Autre"},oe=t=>{var n;const e=((t==null?void 0:t.category)||(t==null?void 0:t.typeLabel)||((n=t==null?void 0:t.type)==null?void 0:n.libelle)||"").toLowerCase();return e.includes("nid")||e.includes("pothole")?"üï≥Ô∏è":e.includes("travaux")||e.includes("roadwork")?"üöß":e.includes("√©clairage")||e.includes("lighting")?"üí°":e.includes("d√©chets")||e.includes("waste")?"üóëÔ∏è":e.includes("feu")||e.includes("traffic")?"üö¶":e.includes("signalisation")||e.includes("signage")?"ü™ß":e.includes("inondation")||e.includes("flood")?"üåä":"‚ö†Ô∏è"},ue=t=>new Date(t).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"}),ie=(t,e)=>t?t.length<=e?t:t.substring(0,e)+"...":"";return E(g,I),E(k,t=>{t==="map"?$(()=>{te()}):r&&(r.remove(),r=null)}),re(async()=>{await R.fetchReports(),$(()=>{x.value&&x.value.$el.focus()})}),de(()=>{r&&(r.remove(),r=null),S.value&&clearTimeout(S.value)}),(t,e)=>(d(),A(l(ce),null,{default:s(()=>[a(l(me),null,{default:s(()=>[a(l(j),null,{default:s(()=>[a(l(ve),{slot:"start"},{default:s(()=>[a(l(C),{"router-link":"/map"},{default:s(()=>[a(l(m),{name:"arrow-back"})]),_:1})]),_:1}),a(l(ge),null,{default:s(()=>[...e[5]||(e[5]=[o("span",{class:"app-logo"},"ROAD ALERT",-1),o("span",{class:"title-sep"},"‚Ä¢",-1),o("span",{class:"app-title"},"Recherche",-1)])]),_:1})]),_:1}),a(l(j),{class:"search-toolbar"},{default:s(()=>[a(l(pe),{ref_key:"searchInput",ref:x,modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=n=>g.value=n),placeholder:"Rechercher des signalements...",onIonInput:O,onIonClear:U,class:"main-search","show-clear-button":"always"},null,8,["modelValue"])]),_:1})]),_:1}),a(l(ye),{fullscreen:!0,class:"search-content"},{default:s(()=>[T.value?(d(),v("div",Fe,[a(l(he),{value:"filters"},{default:s(()=>[a(l(_e),{value:"filters"},{default:s(()=>[a(l(D),{slot:"header",class:"accordion-header"},{default:s(()=>[a(l(m),{name:"filter",slot:"start"}),a(l(f),null,{default:s(()=>[...e[6]||(e[6]=[u("Filtres avanc√©s",-1)])]),_:1}),M.value>0?(d(),A(l(P),{key:0,slot:"end",color:"primary"},{default:s(()=>[u(c(M.value),1)]),_:1})):B("",!0)]),_:1}),o("div",Ae,[o("div",De,[e[11]||(e[11]=o("h4",null,"Statut",-1)),a(l(H),{modelValue:i.value.status,"onUpdate:modelValue":e[1]||(e[1]=n=>i.value.status=n),onIonChange:L,class:"status-filter"},{default:s(()=>[a(l(_),{value:"all"},{default:s(()=>[a(l(f),null,{default:s(()=>[...e[7]||(e[7]=[u("Tous",-1)])]),_:1})]),_:1}),a(l(_),{value:"new"},{default:s(()=>[a(l(f),null,{default:s(()=>[...e[8]||(e[8]=[u("Nouveaux",-1)])]),_:1})]),_:1}),a(l(_),{value:"in_progress"},{default:s(()=>[a(l(f),null,{default:s(()=>[...e[9]||(e[9]=[u("En cours",-1)])]),_:1})]),_:1}),a(l(_),{value:"completed"},{default:s(()=>[a(l(f),null,{default:s(()=>[...e[10]||(e[10]=[u("Termin√©s",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),o("div",Be,[e[21]||(e[21]=o("h4",null,"Cat√©gorie",-1)),a(l(we),{modelValue:i.value.category,"onUpdate:modelValue":e[2]||(e[2]=n=>i.value.category=n),placeholder:"Toutes les cat√©gories",onIonChange:L,class:"category-filter"},{default:s(()=>[a(l(y),{value:"all"},{default:s(()=>[...e[12]||(e[12]=[u("Toutes les cat√©gories",-1)])]),_:1}),a(l(y),{value:"pothole"},{default:s(()=>[...e[13]||(e[13]=[u("Nid-de-poule",-1)])]),_:1}),a(l(y),{value:"roadwork"},{default:s(()=>[...e[14]||(e[14]=[u("Travaux en cours",-1)])]),_:1}),a(l(y),{value:"lighting"},{default:s(()=>[...e[15]||(e[15]=[u("√âclairage d√©fectueux",-1)])]),_:1}),a(l(y),{value:"waste"},{default:s(()=>[...e[16]||(e[16]=[u("D√©chets sur voie",-1)])]),_:1}),a(l(y),{value:"traffic_light"},{default:s(()=>[...e[17]||(e[17]=[u("Feu tricolore HS",-1)])]),_:1}),a(l(y),{value:"signage"},{default:s(()=>[...e[18]||(e[18]=[u("Signalisation manquante",-1)])]),_:1}),a(l(y),{value:"flooding"},{default:s(()=>[...e[19]||(e[19]=[u("Inondation",-1)])]),_:1}),a(l(y),{value:"other"},{default:s(()=>[...e[20]||(e[20]=[u("Autre",-1)])]),_:1})]),_:1},8,["modelValue"])]),o("div",Me,[e[26]||(e[26]=o("h4",null,"P√©riode",-1)),a(l(H),{modelValue:i.value.dateRange,"onUpdate:modelValue":e[3]||(e[3]=n=>i.value.dateRange=n),onIonChange:L,class:"date-filter"},{default:s(()=>[a(l(_),{value:"all"},{default:s(()=>[a(l(f),null,{default:s(()=>[...e[22]||(e[22]=[u("Toutes",-1)])]),_:1})]),_:1}),a(l(_),{value:"week"},{default:s(()=>[a(l(f),null,{default:s(()=>[...e[23]||(e[23]=[u("Cette semaine",-1)])]),_:1})]),_:1}),a(l(_),{value:"month"},{default:s(()=>[a(l(f),null,{default:s(()=>[...e[24]||(e[24]=[u("Ce mois",-1)])]),_:1})]),_:1}),a(l(_),{value:"year"},{default:s(()=>[a(l(f),null,{default:s(()=>[...e[25]||(e[25]=[u("Cette ann√©e",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),o("div",Oe,[a(l(D),{lines:"none",class:"my-reports-filter"},{default:s(()=>[a(l(m),{name:"person",slot:"start",color:"primary"}),a(l(f),null,{default:s(()=>[...e[27]||(e[27]=[u("Mes signalements uniquement",-1)])]),_:1}),a(l(ke),{modelValue:i.value.myReportsOnly,"onUpdate:modelValue":e[4]||(e[4]=n=>i.value.myReportsOnly=n),onIonChange:L,slot:"end"},null,8,["modelValue"])]),_:1})]),o("div",Ue,[a(l(C),{fill:"outline",onClick:J,class:"reset-button"},{default:s(()=>[a(l(m),{name:"refresh",slot:"start"}),e[28]||(e[28]=u(" R√©initialiser ",-1))]),_:1}),a(l(C),{onClick:Z,class:"apply-button"},{default:s(()=>[a(l(m),{name:"checkmark",slot:"start"}),e[29]||(e[29]=u(" Appliquer ",-1))]),_:1})])])]),_:1})]),_:1})])):B("",!0),o("div",ze,[F.value?(d(),v("div",qe,[a(l(Ie),{name:"crescent",color:"primary"}),e[30]||(e[30]=o("p",null,"Recherche en cours...",-1))])):g.value&&p.value.length===0?(d(),v("div",Ne,[a(l(m),{name:"search",size:"large",color:"medium"}),e[32]||(e[32]=o("h3",null,"Aucun r√©sultat",-1)),e[33]||(e[33]=o("p",null,"Aucun signalement ne correspond √† votre recherche.",-1)),a(l(C),{fill:"clear",onClick:U},{default:s(()=>[...e[31]||(e[31]=[u(" Effacer la recherche ",-1)])]),_:1})])):p.value.length>0?(d(),v("div",Ee,[o("div",$e,[o("h3",null,c(p.value.length)+" r√©sultat"+c(p.value.length>1?"s":"")+" trouv√©"+c(p.value.length>1?"s":""),1),a(l(C),{fill:"clear",size:"small",onClick:ee,class:"view-toggle"},{default:s(()=>[a(l(m),{name:k.value==="list"?"map":"list",slot:"start"},null,8,["name"]),u(" "+c(k.value==="list"?"Carte":"Liste"),1)]),_:1})]),k.value==="list"?(d(),v("div",je,[a(l(be),{class:"results-ion-list"},{default:s(()=>[(d(!0),v(G,null,Y(p.value,n=>(d(),A(l(D),{key:n.id,class:"result-item",onClick:b=>q(n),button:""},{default:s(()=>[a(l(Ce),{slot:"start",class:"result-thumbnail"},{default:s(()=>[n.photos&&n.photos.length>0?(d(),v("img",{key:0,src:n.photos[0],alt:"Photo de "+n.title,class:"result-image"},null,8,Pe)):(d(),v("div",He,[a(l(m),{name:"image",color:"medium"})]))]),_:2},1024),a(l(f),{class:"result-label"},{default:s(()=>[o("h2",Ge,c(n.title),1),o("p",Ye,[o("span",Ke,c(oe(n)),1),o("span",Qe,c(ne(n)),1)]),o("p",We,c(ie(n.description,80)),1),o("p",Xe,[a(l(m),{name:"location",size:"small"}),u(" "+c(n.address),1)]),o("p",Ze,[a(l(P),{color:ae(n.status),size:"small"},{default:s(()=>[u(c(N(n.status)),1)]),_:2},1032,["color"]),o("span",Je,c(ue(n.createdAt)),1)])]),_:2},1024),a(l(m),{name:"chevron-forward",slot:"end",color:"medium"})]),_:2},1032,["onClick"]))),128))]),_:1})])):(d(),v("div",et,[o("div",{ref_key:"resultsMap",ref:V,class:"results-map-container"},null,512)]))])):g.value?B("",!0):(d(),v("div",tt,[e[34]||(e[34]=o("h3",null,"Recherches populaires",-1)),o("div",lt,[(d(),v(G,null,Y(W,n=>a(l(Re),{key:n,onClick:b=>le(n),class:"suggestion-chip"},{default:s(()=>[a(l(f),null,{default:s(()=>[u(c(n),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))])]))])]),_:1}),a(l(Se),{vertical:"bottom",horizontal:"end",slot:"fixed"},{default:s(()=>[a(l(Te),{onClick:X},{default:s(()=>[a(l(m),{name:"filter"})]),_:1})]),_:1})]),_:1}))}},ct=Ve(at,[["__scopeId","data-v-00cc8cbf"]]);export{ct as default};
