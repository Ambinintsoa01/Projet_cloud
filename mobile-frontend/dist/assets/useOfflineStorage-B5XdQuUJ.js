import{G as A,ai as t,z as d,y as i}from"./index-vCZlUi6s.js";function Q(){const l=i(navigator.onLine),f=i(!1),o=i(null),u=i(0),c=d(()=>t.getOfflineQueue()),h=d(()=>c.value.length>0),y=d(()=>t.getStorageStats()),O=async e=>{try{return l.value?await g(e):(t.addToOfflineQueue(e),u.value=c.value.length+1,{success:!0,queued:!0,message:"Action mise en file d'attente (hors ligne)"})}catch(s){return o.value=s.message,console.error("Erreur lors de l'ajout Ã  la file:",s),{success:!1,error:s.message}}},g=async e=>{switch(await new Promise(s=>setTimeout(s,500)),e.type){case"CREATE_REPORT":console.log("ðŸ“¤ CrÃ©ation de signalement:",e.payload);break;case"UPDATE_REPORT":console.log("ðŸ“¤ Mise Ã  jour de signalement:",e.payload);break;case"UPLOAD_PHOTO":console.log("ðŸ“¤ Upload de photo:",e.payload);break;default:console.log("ðŸ“¤ Action inconnue:",e)}return{success:!0,executed:!0,message:"Action exÃ©cutÃ©e avec succÃ¨s"}},w=async()=>{if(!l.value)return o.value="Pas de connexion internet",{success:!1,error:"Pas de connexion internet"};f.value=!0,o.value=null;try{const e=[...c.value],s=[];for(const r of e)try{const n=await g(r);s.push({action:r.id,success:!0,result:n}),t.removeFromOfflineQueue(r.id)}catch(n){s.push({action:r.id,success:!1,error:n.message}),console.error(`Erreur lors de la synchro de ${r.id}:`,n)}return u.value=c.value.length-e.length,{success:!0,synced:s.filter(r=>r.success).length,failed:s.filter(r=>!r.success).length,total:e.length,results:s}}catch(e){return o.value=e.message||"Erreur lors de la synchronisation",{success:!1,error:o.value}}finally{f.value=!1}},S=()=>{t.clearOfflineQueue(),u.value=0},P=()=>t.getReportsData(),R=e=>t.setReportsData(e),E=()=>t.getUserPreferences(),D=e=>t.setUserPreferences(e),U=(e=30*24*60*60*1e3)=>t.cleanup(e),L=()=>{try{const e={reports:t.getReportsData(),preferences:t.getUserPreferences(),settings:t.getAppSettings(),exportDate:new Date().toISOString(),version:"1.0.0"},s=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(s),n=document.createElement("a");return n.href=r,n.download=`signalement_backup_${new Date().toISOString().split("T")[0]}.json`,n.click(),URL.revokeObjectURL(r),{success:!0,message:"DonnÃ©es exportÃ©es avec succÃ¨s"}}catch(e){return o.value="Erreur lors de l'export",{success:!1,error:e.message}}},x=e=>new Promise(s=>{const r=new FileReader;r.onload=n=>{var m;try{const a=JSON.parse(n.target.result);a.reports&&t.setReportsData(a.reports),a.preferences&&t.setUserPreferences(a.preferences),a.settings&&t.setAppSettings(a.settings),s({success:!0,message:"DonnÃ©es importÃ©es avec succÃ¨s",imported:{reports:((m=a.reports)==null?void 0:m.length)||0,preferences:!!a.preferences,settings:!!a.settings}})}catch{s({success:!1,error:"Fichier JSON invalide"})}},r.onerror=()=>{s({success:!1,error:"Erreur lors de la lecture du fichier"})},r.readAsText(e)}),p=()=>{l.value=!0},v=()=>{l.value=!1};return A(c,e=>{u.value=e.length},{immediate:!0}),window.addEventListener("online",p),window.addEventListener("offline",v),{isOnline:l,isLoading:f,error:o,pendingSyncCount:u,offlineQueue:c,hasPendingSync:h,storageStats:y,addToSyncQueue:O,syncOfflineData:w,clearOfflineQueue:S,getStoredReports:P,saveReportsLocally:R,getUserPreferences:E,saveUserPreferences:D,cleanupStorage:U,exportData:L,importData:x,cleanup:()=>{window.removeEventListener("online",p),window.removeEventListener("offline",v)}}}export{Q as u};
